<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <h1>Headline</h1>
    <button onclick="destroyCalendars()">Destroy Calendars</button>

    <div id="testDiv">
        <input id="whatever" type="text" onclick="initPopup('whatever')">
    </div>




    <ul>
        <li>How many days in each month   DONE</li>
        <li>On what day does the month start? DONE</li>
        <li>Div positioning (up)</li>
    </ul>
<p style="height: 900px;">
    &nbsp;
</p>

<script>
//please change these settings to suit your language
var dayNames = [
    "Monday", 
    "Tuesday", 
    "Wednesday", 
    "Thursday", 
    "Friday", 
    "Saturday", 
    "Sunday"
];

var monthNames = [
    "January",
    "February",
    "March",
    "April",
    "May",
    "June",
    "July",
    "August",
    "September",
    "October",
    "November",
    "December"
];

var calendarCanvas = 'large';

console.log(dayNames);
console.log(monthNames);


var getDaysInMonth = function(month,year) {
  // Here January is 1 based
  //Day 0 is the last day in the previous month
 return new Date(year, month, 0).getDate();
// Here January is 0 based
// return new Date(year, month+1, 0).getDate();
};
console.log(getDaysInMonth(2, 1976));
console.log(getDaysInMonth(11, 2012));
console.log(getDaysInMonth(9, 2012));
console.log(getDaysInMonth(12, 2012));


var d = new Date();
var n = d.getDay();
console.log('The day is ' + n);

function initPopup(elId) {

    destroyCalendars();

    var newPopupCalendar = document.createElement("div");
    newPopupCalendar.setAttribute("class", "tg-datepicker");

    if (calendarCanvas == 'large') {
        var referenceNode = document.getElementById(elId);
        referenceNode.parentNode.insertBefore(newPopupCalendar, referenceNode.nextSibling);
    } else {

        //create an overlay div
        var overlayDiv = document.createElement("div");
        overlayDiv.setAttribute("id", "tg-calendar-overlay");
        var pageBody = document.getElementsByTagName("body")[0];
        pageBody.appendChild(overlayDiv);

        newPopupCalendar.classList.add("tg-datepicker-small-canvas");
        var referenceNode = overlayDiv;

        referenceNode.appendChild(newPopupCalendar);
    }

    //use javascript to select body
    
    var calendarHead = document.createElement("div");

    calendarHead.setAttribute("class", "datepicker-head");

    var calendarHeadLeft = document.createElement("div");
    calendarHead.appendChild(calendarHeadLeft);

    var calendarArrowDivLeft = document.createElement("div");
    calendarArrowDivLeft.setAttribute("class", "popup-arrow");

    var flipArrowSpan = document.createElement("span");
    flipArrowSpan.setAttribute("class", "flip-arrow");
    var calendarNavArrowLeft = document.createTextNode("▸");
    flipArrowSpan.appendChild(calendarNavArrowLeft);

    calendarArrowDivLeft.appendChild(flipArrowSpan);
    calendarHeadLeft.appendChild(calendarArrowDivLeft);

    var calendarHeadCenter = document.createElement("div");
    var calendarHeadline = document.createTextNode("December 1984");
    calendarHeadCenter.appendChild(calendarHeadline);
    
    calendarHead.appendChild(calendarHeadCenter);

    var calendarHeadRight = document.createElement("div");
    var calendarArrowDivRight = document.createElement("div");
    calendarArrowDivRight.setAttribute("class", "popup-arrow");

    var calendarNavArrowRight = document.createTextNode("▸");
    calendarArrowDivRight.appendChild(calendarNavArrowRight);
    calendarHeadRight.appendChild(calendarArrowDivRight);


    calendarHead.appendChild(calendarHeadRight);
    
    newPopupCalendar.appendChild(calendarHead);

    //generate table
    var calendarTbl = document.createElement("table");

    //create the top row
    var calendarTblTopRow = document.createElement("tr");
    calendarTblTopRow.setAttribute("class", "tg-datepicker-row");

    var calendarTblTh = document.createElement("th");
    var calendarTblThTxt = document.createTextNode("Mon");
    calendarTblTh.appendChild(calendarTblThTxt);
    calendarTblTopRow.appendChild(calendarTblTh);

    calendarTblTh = document.createElement("th");
    calendarTblThTxt = document.createTextNode("Tue");
    calendarTblTh.appendChild(calendarTblThTxt);
    calendarTblTopRow.appendChild(calendarTblTh);

    calendarTblTh = document.createElement("th");
    calendarTblThTxt = document.createTextNode("Wed");
    calendarTblTh.appendChild(calendarTblThTxt);
    calendarTblTopRow.appendChild(calendarTblTh);

    calendarTblTh = document.createElement("th");
    calendarTblThTxt = document.createTextNode("Thu");
    calendarTblTh.appendChild(calendarTblThTxt);
    calendarTblTopRow.appendChild(calendarTblTh);

    calendarTblTh = document.createElement("th");
    calendarTblThTxt = document.createTextNode("Fri");
    calendarTblTh.appendChild(calendarTblThTxt);
    calendarTblTopRow.appendChild(calendarTblTh);

    calendarTblTh = document.createElement("th");
    calendarTblThTxt = document.createTextNode("Sat");
    calendarTblTh.appendChild(calendarTblThTxt);
    calendarTblTopRow.appendChild(calendarTblTh);

    calendarTblTh = document.createElement("th");
    calendarTblThTxt = document.createTextNode("Sun");
    calendarTblTh.appendChild(calendarTblThTxt);
    calendarTblTopRow.appendChild(calendarTblTh);

    calendarTbl.appendChild(calendarTblTopRow);

    //create a week row
    var calendarWeekRow = document.createElement("tr");
    calendarWeekRow.setAttribute("class", "tg-datepicker-row");

    var calendarTblTd = document.createElement("td");
    var calendarTblTdTxt = document.createTextNode(" ");
    calendarTblTd.appendChild(calendarTblTdTxt);
    calendarTblTd.setAttribute("class", "empty-day");
    calendarWeekRow.appendChild(calendarTblTd);

    calendarTblTd = document.createElement("td");
    calendarTblTdTxt = document.createTextNode(" ");
    calendarTblTd.appendChild(calendarTblTdTxt);
    calendarTblTd.setAttribute("class", "empty-day");
    calendarWeekRow.appendChild(calendarTblTd);

    calendarTblTd = document.createElement("td");
    calendarTblTdTxt = document.createTextNode("1");
    calendarTblTd.appendChild(calendarTblTdTxt);
    calendarWeekRow.appendChild(calendarTblTd);

    calendarTblTd = document.createElement("td");
    calendarTblTdTxt = document.createTextNode("2");
    calendarTblTd.appendChild(calendarTblTdTxt);
    calendarWeekRow.appendChild(calendarTblTd);

    calendarTblTd = document.createElement("td");
    calendarTblTdTxt = document.createTextNode("3");
    calendarTblTd.appendChild(calendarTblTdTxt);
    calendarTblTd.setAttribute("class", "current-day");
    calendarWeekRow.appendChild(calendarTblTd);

    calendarTblTd = document.createElement("td");
    calendarTblTdTxt = document.createTextNode("4");
    calendarTblTd.appendChild(calendarTblTdTxt); 
    calendarTblTd.setAttribute("class", "unavailable-day");
    calendarWeekRow.appendChild(calendarTblTd);

    calendarTblTd = document.createElement("td");
    calendarTblTdTxt = document.createTextNode("5");
    calendarTblTd.appendChild(calendarTblTdTxt);
    calendarWeekRow.appendChild(calendarTblTd);

    calendarTbl.appendChild(calendarWeekRow);

    //generate three sample week rows
    for (var i = 0; i < 3; i++) {
        
        //create a week row
        calendarWeekRow = document.createElement("tr");
        calendarWeekRow.setAttribute("class", "tg-datepicker-row");

        calendarTblTd = document.createElement("td");
        calendarTblTdTxt = document.createTextNode("xx");
        calendarTblTd.appendChild(calendarTblTdTxt);
        calendarWeekRow.appendChild(calendarTblTd);

        calendarTblTd = document.createElement("td");
        calendarTblTdTxt = document.createTextNode("xx");
        calendarTblTd.appendChild(calendarTblTdTxt);
        calendarWeekRow.appendChild(calendarTblTd);

        calendarTblTd = document.createElement("td");
        calendarTblTdTxt = document.createTextNode("xx");
        calendarTblTd.appendChild(calendarTblTdTxt);
        calendarWeekRow.appendChild(calendarTblTd);

        calendarTblTd = document.createElement("td");
        calendarTblTdTxt = document.createTextNode("xx");
        calendarTblTd.appendChild(calendarTblTdTxt);
        calendarWeekRow.appendChild(calendarTblTd);

        calendarTblTd = document.createElement("td");
        calendarTblTdTxt = document.createTextNode("xx");
        calendarTblTd.appendChild(calendarTblTdTxt);
        calendarWeekRow.appendChild(calendarTblTd);

        calendarTblTd = document.createElement("td");
        calendarTblTdTxt = document.createTextNode("xx");
        calendarTblTd.appendChild(calendarTblTdTxt); 
        calendarWeekRow.appendChild(calendarTblTd);

        calendarTblTd = document.createElement("td");
        calendarTblTdTxt = document.createTextNode("xx");
        calendarTblTd.appendChild(calendarTblTdTxt);
        calendarWeekRow.appendChild(calendarTblTd);

        calendarTbl.appendChild(calendarWeekRow);
    }

        //sample btm row
        //create a week row
        calendarWeekRow = document.createElement("tr");
        calendarWeekRow.setAttribute("class", "tg-datepicker-row");

        calendarTblTd = document.createElement("td");
        calendarTblTdTxt = document.createTextNode("29");
        calendarTblTd.appendChild(calendarTblTdTxt);
        calendarWeekRow.appendChild(calendarTblTd);

        calendarTblTd = document.createElement("td");
        calendarTblTdTxt = document.createTextNode("30");
        calendarTblTd.appendChild(calendarTblTdTxt);
        calendarWeekRow.appendChild(calendarTblTd);

        calendarTblTd = document.createElement("td");
        calendarTblTdTxt = document.createTextNode("31");
        calendarTblTd.appendChild(calendarTblTdTxt);
        calendarWeekRow.appendChild(calendarTblTd);

        calendarTblTd = document.createElement("td");
        calendarTblTdTxt = document.createTextNode(" ");
        calendarTblTd.appendChild(calendarTblTdTxt);
        calendarTblTd.setAttribute("class", "empty-day");
        calendarWeekRow.appendChild(calendarTblTd);

        calendarTblTd = document.createElement("td");
        calendarTblTdTxt = document.createTextNode(" ");
        calendarTblTd.appendChild(calendarTblTdTxt);
        calendarTblTd.setAttribute("class", "empty-day");
        calendarWeekRow.appendChild(calendarTblTd);

        calendarTblTd = document.createElement("td");
        calendarTblTdTxt = document.createTextNode(" ");
        calendarTblTd.appendChild(calendarTblTdTxt);
        calendarTblTd.setAttribute("class", "empty-day");
        calendarWeekRow.appendChild(calendarTblTd);

        calendarTblTd = document.createElement("td");
        calendarTblTdTxt = document.createTextNode(" ");
        calendarTblTd.appendChild(calendarTblTdTxt);
        calendarTblTd.setAttribute("class", "empty-day");
        calendarWeekRow.appendChild(calendarTblTd);

        calendarTbl.appendChild(calendarWeekRow);
        newPopupCalendar.appendChild(calendarTbl);

        if (calendarCanvas == 'small') {
            adjustCalendarHeight();
        }
        
}

function adjustCalendarHeight() {
    var targetCalendar = document.getElementsByClassName("tg-datepicker")[0];
    var intViewportWidth = window.innerWidth;
    var intViewportHeight = window.innerHeight;

    if (intViewportWidth<intViewportHeight) {
        //we should make the calendar height equal to the calendar width
        //targetCalendar.style.height = intViewportWidth*0.92 + 'px';
        
        //fetch all of the popup calendar rows
        var allPopupTblRows = document.getElementsByClassName("tg-datepicker-row");
        for (var i = 0; i < allPopupTblRows.length; i++) {
            increaseCellPadding(allPopupTblRows[i])
        }

    } else {
        //we should make the calendar width equal to the calendar height
        targetCalendar.style.maxWidth = '350px';
    }
}

function increaseCellPadding(tblRow) {
    var rowCells = tblRow.children;
    for (var i = 0; i < rowCells.length; i++) {
        rowCells[i].style.padding = '1.5em 0.7em';
    }
}

function destroyCalendars() {

    var tgCalendars = document.getElementsByClassName("tg-datepicker");

    if (calendarCanvas == 'small') {

        if (tgCalendars.length>0) {
            document.getElementById("tg-calendar-overlay").remove();
        }
        
    } else {

        while(tgCalendars.length>0) {
            tgCalendars[0].remove();
        }

    }

}

function watchScreenSize() {
    console.log('WATCHING');
    var intViewportWidth = window.innerWidth;
    var intViewportHeight = window.innerHeight;
    console.log(`width is ${intViewportWidth} and height is ${intViewportHeight}`);

    if (intViewportWidth<600) {
        calendarCanvas = 'small';
    } else {
        calendarCanvas = 'large';
    }

    destroyCalendars();
    console.log('the canvas size is ' + calendarCanvas + ' since viewport width is ' + intViewportWidth);
}

window.addEventListener("resize", watchScreenSize);
watchScreenSize();

setTimeout(() => {

    console.log("initing popup");
    initPopup('whatever');

}, 2000);

setTimeout(() => {

    destroyCalendars();

}, 4000);

function childOf( node, ancestor ) {
    var child = node;
    while (child !== null) {
        if (child === ancestor) return true;
        child = child.parentNode;
    }
    return false;   
}

function attemptDestroy(ev) {

    var tgCalendars = document.getElementsByClassName("tg-datepicker");

    if (tgCalendars.length>0) {
        var clickedEl = ev.target;
        var targetAncestor = tgCalendars[0];
        var isChild = childOf(clickedEl, targetAncestor);

        if (isChild !== true) {
            destroyCalendars();
        }
    }

}



var pageBody = document.getElementsByTagName("body")[0];
pageBody.addEventListener("click", (ev) => {

    if (ev.target.id !== 'whatever') {
        attemptDestroy(ev);
    }

    

    // javascript check if clicked element is inside target div





});  
</script>

<style>
#txestDivx {
    width: 450px;
    height: 150px;
    left: 367px;
    top: 32%;
    margin-top: 10em;
    position: relative;
}

#testDiv {
    z-index: 99;
}

.tg-datepicker {
    width: 400px;
    border: 1px #36658c solid;
    font-family: Lucida console;
    letter-spacing: 1px;
    background-color: white;
    position: absolute;
}

.tg-datepicker-small-canvas {
    width: 96%;
    font-size: 0.7em;
}

table {
    width: 100%;
}

th {
    color: #333;
    font-weight: bold;
}

th, td {
    padding: 0.7em;
    text-align: center;
}

td {
    background-color: #4682b424;
    border: 1px #829eb59e solid;
}

td:hover:not(.empty-day):not(.unavailable-day):not(.current-day) {
    background-color: #cfdfec;
}

.empty-day {
    background-color: white;
    border: 1px white solid;
}

.unavailable-day {
    background-color: #fff;
    color: silver;
    cursor: default !important;
}

.unavailabe-day, .empty-day {
    cursor: default !important;
}

.current-day {
    background-color: SteelBlue;
    color: white;
}

.current-day:hover {
    background-color: #346893;
}

td:hover {
    cursor: pointer;
}

tr:hover, tr:nth-child(odd):hover {
    bxackground-color: #fdfdea;
}

tr:nth-child(odd) {
    bxackground-color: #f3f3f3;
}

.datepicker-head {
    background-color: SteelBlue;
    display: flex;
    flex-direction: row;
    justify-content: space-between;
    align-items: center;
    padding: 10px 6px;
}

.datepicker-head > div:nth-child(odd) {
    cursor: pointer;
}

.datepicker-head > div:nth-child(2) {
    font-size: 1.2em;
    font-weight: bold;
    color: white;
}

.popup-arrow {
    background-color: white;
    height: 24px;
    width: 24px;
    border-radius: 4px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: SteelBlue;
}

.flip-arrow {
    transform: rotate(180deg);
    top: 1px;
    left: 0px;
    position: relative;
}

#tg-calendar-overlay {
    position:fixed;
    top:0;
    left:0;
    background:rgba(0,0,0,0.8);
    z-index:5;
    width:100%;
    height:100%;
    display: flex;
    align-items: center;
    justify-content: center;
}


</style>
















</body>
</html>